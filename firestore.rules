rules_version = '2';
service cloud.firestore {
  match /databases/{database}/documents {

    // -----------------------------
    // ADMIN CONFIG – ADMIN PANEL
    // -----------------------------
    match /adminConfig/{doc} {

      // Admin can READ the admin code
      allow read: if true;

      // Admin can update code ONLY if old code matches
      allow update: if
        request.resource.data.adminOldKey ==
        get(/databases/$(database)/documents/adminConfig/main).data.adminCode;

      // Prevent accidental create/delete
      allow create, delete: if false;
    }

    // -----------------------------
    // NOTES – PUBLIC READ
    // -----------------------------
    match /notes/{id} {
      allow read: if true;

      // Admin can CREATE notes using adminKey
      allow create: if
        request.resource.data.adminKey ==
        get(/databases/$(database)/documents/adminConfig/main).data.adminCode;

      allow update, delete: if false;
    }

    // -----------------------------
    // MCQ SETS – PUBLIC READ
    // -----------------------------
    match /mcqSets/{id} {
      allow read: if true;

      allow create: if
        request.resource.data.adminKey ==
        get(/databases/$(database)/documents/adminConfig/main).data.adminCode;

      allow update, delete: if false;
    }

    // -----------------------------
    // GENERAL SAFETY
    // -----------------------------
    match /{document=**} {
      allow read: if false;
      allow write: if false;
    }

  }
}
