
rules_version = '2';

service cloud.firestore {
  match /databases/{database}/documents {

    // Default: Disallow all reads/writes unless explicitly allowed.
    match /{document=**} {
      allow read, write: if false;
    }

    // Users collection:
    // - Allow anyone to create a user document (on signup).
    // - Allow users to read their own data.
    // - Allow admin to read/write any user document.
    match /users/{userId} {
      allow create: if request.auth != null;
      allow read: if request.auth.uid == userId;
      allow write: if request.auth.uid == 'sRiwSuQlxgbGRUcO7CevaJxQBEq2';
    }

    // Progress sub-collection for users:
    // - Allow a user to write to their own progress data.
    // - Allow admin to read any progress data.
    match /users/{userId}/progress/{docId} {
      allow read, write: if request.auth.uid == userId || request.auth.uid == 'sRiwSuQlxgbGRUcO7CevaJxQBEq2';
    }

    // Notes collection:
    // - Allow any authenticated user to read notes.
    // - Allow only the admin to write/delete notes.
    match /notes/{noteId} {
      allow read: if request.auth != null;
      allow write: if request.auth.uid == 'sRiwSuQlxgbGRUcO7CevaJxQBEq2';
    }

    // Marketing config:
    // - Allow any authenticated user to read the config.
    // - Allow only the admin to write to the config.
    match /marketing_config/{docId} {
      allow read: if request.auth != null;
      allow write: if request.auth.uid == 'sRiwSuQlxgbGRUcO7CevaJxQBEq2';
    }

    // Newsletter subscriptions:
    // - Allow anyone to create a subscription.
    // - Allow only the admin to read/delete subscriptions.
    match /newsletter_subscriptions/{subscriptionId} {
      allow create: if true;
      allow read, delete: if request.auth.uid == 'sRiwSuQlxgbGRUcO7CevaJxQBEq2';
    }
  }
}
