
rules_version = '2';

service cloud.firestore {
  match /databases/{database}/documents {

    // --- Users Collection ---
    // Users can:
    // - Create their own user document upon signup.
    // - Read and update their own user document.
    // - Admins can view the list of all users.
    match /users/{userId} {
      allow create: if request.auth != null;
      allow read, update: if request.auth.uid == userId;
      allow list: if request.auth.uid == 'sRiwSuQlxgbGRUcO7CevaJxQBEq2'; // Hardcoded Admin UID
    }

    // --- Notes Collection ---
    // Notes can be:
    // - Read by any authenticated user.
    // - Created, updated, or deleted only by an admin user.
    match /notes/{noteId} {
      allow read: if request.auth != null;
      allow write: if request.auth.uid == 'sRiwSuQlxgbGRUcO7CevaJxQBEq2'; // Hardcoded Admin UID
    }

    // --- Newsletter Subscriptions ---
    // Anyone can subscribe (write their email), but only admins can read the list.
    match /newsletter_subscriptions/{subId} {
        allow create: if true;
        allow read: if request.auth.uid == 'sRiwSuQlxgbGRUcO7CevaJxQBEq2';
    }

    // --- User Progress Sub-collection ---
    // Users can only read and write to their own progress documents.
    match /users/{userId}/progress/{progressId} {
        allow read, write: if request.auth.uid == userId;
    }
  }
}
