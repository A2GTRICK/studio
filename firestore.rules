rules_version = '2';
service cloud.firestore {
  match /databases/{database}/documents {

    // =============================
    // PUBLIC READ-ONLY COLLECTIONS
    // =============================

    match /notes/{id} {
      allow list, read: if true;
      // Writes can be managed via the admin panel/API
      allow write: if false; 
    }

    match /mcqSets/{id} {
      allow list, read: if true;
      allow write: if false;
    }

    match /posts/{id} {
      allow list, read: if true;
      allow write: if false;
    }
    
    match /blog/{id} {
      allow list, read: if true;
      allow write: if false;
    }

    match /custom_notifications/{id} {
      allow list, read: if true;
      allow write: if false;
    }
    
    match /tests/{id} {
      allow list, read: if true;
      allow write: if false;
    }

    match /test_series/{testId} {
      allow list, read: if true;
      allow write: if false;
    }


    // =============================
    // USER-SPECIFIC DATA
    // =============================

    match /users/{uid} {
      // Users can only read their own data
      allow read: if request.auth != null && request.auth.uid == uid;
      // Allow user creation or update by the user themselves
      allow write: if request.auth != null && request.auth.uid == uid;
    }
    
    match /testAttempts/{id} {
      // A user can read their own test attempts
      allow read: if request.auth != null && request.auth.uid == resource.data.userId;
      // Any authenticated user can create an attempt (when they submit a test)
      allow create: if request.auth != null;
      // Users cannot update or delete their past attempts
      allow update, delete: if false;
    }

    // =============================
    // ADMIN CONFIG (publicly readable)
    // =============================
    match /adminConfig/{doc} {
      allow read: if true;
      allow write: if false; // Should be managed via Admin SDK
    }
  }
}
