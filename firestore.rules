rules_version = '2';
service cloud.firestore {
  match /databases/{database}/documents {

    function isAdmin() {
      return request.auth.uid == "s5d4Z9q3N4Xb2P1hA6jK7cV8wFp2";
    }

    // PUBLIC READ-ONLY COLLECTIONS
    match /notes/{noteId} {
      allow read: if true;
      allow write: if isAdmin();
    }
    
    match /mcqSets/{setId} {
      allow read: if true;
      allow write: if isAdmin();
    }

    match /custom_notifications/{id} {
      allow read: if true;
      allow write: if isAdmin();
    }
    
    match /posts/{postId} {
      allow read: if true;
      allow write: if isAdmin();
    }
    
    match /blog/{postId} {
      allow read: if true;
      allow write: if isAdmin();
    }
    
    match /tests/{testId} {
      allow read: if true;           // required for queries + snapshot
      allow write: if false;         // server only
      match /{sub=**} {
        allow read: if true;
        allow write: if false;
      }
    }

    // OTHER COLLECTIONS  
    match /adminConfig/{doc} {
      allow read: if true;
      allow write: if isAdmin();
    }

    match /results/{resultId} {
      allow read: if request.auth != null;
      allow create, update, delete: if false;
    }

    match /users/{uid} {
      allow read: if request.auth != null && request.auth.uid == uid;
      allow write: if false;
    }

    // Deny everything else
    match /{document=**} {
      allow write: if false;
    }
  }
}
