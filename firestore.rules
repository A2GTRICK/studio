rules_version = '2';
service cloud.firestore {
  match /databases/{database}/documents {

    // -----------------------------
    // ADMIN CONFIG – ADMIN PANEL
    // -----------------------------
    match /adminConfig/{doc} {
      allow read: if true;  // allow admin code to be read publicly for login
      allow update: if request.resource.data.adminOldKey ==
                    get(/databases/$(database)/documents/adminConfig/main).data.adminCode;
      allow create, delete: if false;
    }

    // -----------------------------
    // NOTES – PUBLIC READ
    // -----------------------------
    match /notes/{id} {
      allow read: if true;

      allow create: if
        request.resource.data.adminKey ==
        get(/databases/$(database)/documents/adminConfig/main).data.adminCode;

      allow update, delete: if false;
    }

    // -----------------------------
    // MCQ SETS – PUBLIC READ
    // -----------------------------
    match /mcqSets/{id} {
      allow read: if true;

      allow create: if
        request.resource.data.adminKey ==
        get(/databases/$(database)/documents/adminConfig/main).data.adminCode;

      allow update, delete: if false;
    }
  }
}